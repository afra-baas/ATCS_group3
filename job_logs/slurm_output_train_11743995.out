/home/lcur1101/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:561: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
task  SA
self.device  cuda
/home/lcur1101/ATCS_group3/marc_data/dataset_fr_train.json
Time taken to execute pipeline function: 0:00:00.000059
Time taken to execute prompt gen: 0:00:00.000078
Time taken to execute mapping: 0:00:00.000208
summary:  |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   2133 MiB |   2133 MiB |   2133 MiB |      0 B   |
|       from large pool |   2132 MiB |   2132 MiB |   2132 MiB |      0 B   |
|       from small pool |      1 MiB |      1 MiB |      1 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |   2133 MiB |   2133 MiB |   2133 MiB |      0 B   |
|       from large pool |   2132 MiB |   2132 MiB |   2132 MiB |      0 B   |
|       from small pool |      1 MiB |      1 MiB |      1 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |   2133 MiB |   2133 MiB |   2133 MiB |      0 B   |
|       from large pool |   2132 MiB |   2132 MiB |   2132 MiB |      0 B   |
|       from small pool |      1 MiB |      1 MiB |      1 MiB |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2134 MiB |   2134 MiB |   2134 MiB |      0 B   |
|       from large pool |   2132 MiB |   2132 MiB |   2132 MiB |      0 B   |
|       from small pool |      2 MiB |      2 MiB |      2 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 784384 B   |  18404 KiB | 395260 KiB | 394494 KiB |
|       from large pool |      0 B   |  16384 KiB | 393216 KiB | 393216 KiB |
|       from small pool | 784384 B   |   2044 KiB |   2044 KiB |   1278 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     295    |     295    |       0    |
|       from large pool |      97    |      97    |      97    |       0    |
|       from small pool |     198    |     198    |     198    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     295    |     295    |       0    |
|       from large pool |      97    |      97    |      97    |       0    |
|       from small pool |     198    |     198    |     198    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      74    |      74    |      74    |       0    |
|       from large pool |      73    |      73    |      73    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      25    |      24    |
|       from large pool |       0    |       1    |      24    |      24    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

pred_answer ['positive', 'negative', 'negative', 'negative', 'negative', 'negative', 'positive', 'negative']
Time taken to execute classification (32): 0:00:00.881619
pred_answer  ['positive', 'negative', 'negative', 'negative', 'negative', 'negative', 'positive', 'negative']
mapped_labels  ['negative', 'negative', 'negative', 'negative', 'negative', 'negative', 'negative', 'negative']
Batch acc:  0.75

Time taken to execute pipeline function: 0:00:00.000015
Time taken to execute prompt gen: 0:00:00.000021
Time taken to execute mapping: 0:00:00.000193
summary:  |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6718 MiB |  10010 MiB |  12116 MiB |   5398 MiB |
|       from large pool |   6716 MiB |  10008 MiB |  12018 MiB |   5302 MiB |
|       from small pool |      1 MiB |      2 MiB |     98 MiB |     96 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6718 MiB |  10010 MiB |  12116 MiB |   5398 MiB |
|       from large pool |   6716 MiB |  10008 MiB |  12018 MiB |   5302 MiB |
|       from small pool |      1 MiB |      2 MiB |     98 MiB |     96 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6718 MiB |  10010 MiB |  12104 MiB |   5386 MiB |
|       from large pool |   6716 MiB |  10008 MiB |  12006 MiB |   5290 MiB |
|       from small pool |      1 MiB |      2 MiB |     98 MiB |     96 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   9162 MiB |  10286 MiB |  10286 MiB |   1124 MiB |
|       from large pool |   9160 MiB |  10282 MiB |  10282 MiB |   1122 MiB |
|       from small pool |      2 MiB |      4 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 249359 KiB | 259300 KiB |   1696 MiB |   1453 MiB |
|       from large pool | 249216 KiB | 259200 KiB |   1598 MiB |   1355 MiB |
|       from small pool |    143 KiB |   2044 KiB |     98 MiB |     98 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     812    |     818    |    1122    |     310    |
|       from large pool |     509    |     512    |     704    |     195    |
|       from small pool |     303    |     307    |     418    |     115    |
|---------------------------------------------------------------------------|
| Active allocs         |     812    |     818    |    1122    |     310    |
|       from large pool |     509    |     512    |     704    |     195    |
|       from small pool |     303    |     307    |     418    |     115    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     365    |     369    |     369    |       4    |
|       from large pool |     364    |     367    |     367    |       3    |
|       from small pool |       1    |       2    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |     101    |     104    |     326    |     225    |
|       from large pool |      97    |     100    |     220    |     123    |
|       from small pool |       4    |       6    |     106    |     102    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

pred_answer ['positive', 'positive', 'positive', 'positive', 'positive', 'positive', 'negative', 'positive']
Time taken to execute classification (32): 0:00:00.158071
pred_answer  ['positive', 'positive', 'positive', 'positive', 'positive', 'positive', 'negative', 'positive']
mapped_labels  ['positive', 'negative', 'negative', 'positive', 'positive', 'negative', 'negative', 'positive']
Batch acc:  0.625

Time taken to execute pipeline function: 0:00:00.000018
Time taken to execute prompt gen: 0:00:00.000024
Time taken to execute mapping: 0:00:00.000055
summary:  |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  11261 MiB |  14509 MiB |  21977 MiB |  10716 MiB |
|       from large pool |  11258 MiB |  14506 MiB |  21782 MiB |  10523 MiB |
|       from small pool |      2 MiB |      3 MiB |    194 MiB |    192 MiB |
|---------------------------------------------------------------------------|
| Active memory         |  11261 MiB |  14509 MiB |  21977 MiB |  10716 MiB |
|       from large pool |  11258 MiB |  14506 MiB |  21782 MiB |  10523 MiB |
|       from small pool |      2 MiB |      3 MiB |    194 MiB |    192 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |  11228 MiB |  14474 MiB |  21921 MiB |  10692 MiB |
|       from large pool |  11226 MiB |  14472 MiB |  21726 MiB |  10500 MiB |
|       from small pool |      2 MiB |      3 MiB |    194 MiB |    192 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  13776 MiB |  14856 MiB |  15980 MiB |   2204 MiB |
|       from large pool |  13772 MiB |  14852 MiB |  15974 MiB |   2202 MiB |
|       from small pool |      4 MiB |      4 MiB |      6 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 355301 KiB |   1369 MiB |   5875 MiB |   5528 MiB |
|       from large pool | 353728 KiB |   1368 MiB |   5679 MiB |   5333 MiB |
|       from small pool |   1573 KiB |      1 MiB |    196 MiB |    194 MiB |
|---------------------------------------------------------------------------|
| Allocations           |    1328    |    1334    |    1948    |     620    |
|       from large pool |     920    |     923    |    1310    |     390    |
|       from small pool |     408    |     412    |     638    |     230    |
|---------------------------------------------------------------------------|
| Active allocs         |    1328    |    1334    |    1948    |     620    |
|       from large pool |     920    |     923    |    1310    |     390    |
|       from small pool |     408    |     412    |     638    |     230    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     500    |     501    |     505    |       5    |
|       from large pool |     498    |     499    |     502    |       4    |
|       from small pool |       2    |       2    |       3    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |     146    |     147    |     506    |     360    |
|       from large pool |     140    |     141    |     389    |     249    |
|       from small pool |       6    |       7    |     117    |     111    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

pred_answer ['positive', 'positive', 'negative', 'positive', 'positive', 'negative', 'positive', 'positive']
Time taken to execute classification (32): 0:00:00.138730
pred_answer  ['positive', 'positive', 'negative', 'positive', 'positive', 'negative', 'positive', 'positive']
mapped_labels  ['positive', 'negative', 'negative', 'positive', 'positive', 'positive', 'positive', 'negative']
Batch acc:  0.625

Time taken to execute pipeline function: 0:00:00.000017
Time taken to execute prompt gen: 0:00:00.000025
Time taken to execute mapping: 0:00:00.000076
summary:  |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  15687 MiB |  18820 MiB |  31532 MiB |  15844 MiB |
|       from large pool |  15684 MiB |  18817 MiB |  31240 MiB |  15556 MiB |
|       from small pool |      3 MiB |      4 MiB |    291 MiB |    288 MiB |
|---------------------------------------------------------------------------|
| Active memory         |  15687 MiB |  18820 MiB |  31532 MiB |  15844 MiB |
|       from large pool |  15684 MiB |  18817 MiB |  31240 MiB |  15556 MiB |
|       from small pool |      3 MiB |      4 MiB |    291 MiB |    288 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |  15572 MiB |  18703 MiB |  31370 MiB |  15798 MiB |
|       from large pool |  15569 MiB |  18700 MiB |  31078 MiB |  15509 MiB |
|       from small pool |      3 MiB |      4 MiB |    291 MiB |    288 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  18240 MiB |  19284 MiB |  21488 MiB |   3248 MiB |
|       from large pool |  18236 MiB |  19278 MiB |  21480 MiB |   3244 MiB |
|       from small pool |      4 MiB |      6 MiB |      8 MiB |      4 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 471398 KiB |   1427 MiB |  10004 MiB |   9544 MiB |
|       from large pool | 470433 KiB |   1426 MiB |   9712 MiB |   9252 MiB |
|       from small pool |    965 KiB |      2 MiB |    292 MiB |    291 MiB |
|---------------------------------------------------------------------------|
| Allocations           |    1844    |    1850    |    2774    |     930    |
|       from large pool |    1331    |    1334    |    1916    |     585    |
|       from small pool |     513    |     517    |     858    |     345    |
|---------------------------------------------------------------------------|
| Active allocs         |    1844    |    1850    |    2774    |     930    |
|       from large pool |    1331    |    1334    |    1916    |     585    |
|       from small pool |     513    |     517    |     858    |     345    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     630    |     632    |     637    |       7    |
|       from large pool |     628    |     629    |     633    |       5    |
|       from small pool |       2    |       3    |       4    |       2    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |     198    |     199    |     717    |     519    |
|       from large pool |     191    |     193    |     562    |     371    |
|       from small pool |       7    |       8    |     155    |     148    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Traceback (most recent call last):
  File "/home/lcur1101/ATCS_group3/code/pipeline_file.py", line 217, in <module>
    acc = pipeline(LM_model, task, prompt_generator)
  File "/home/lcur1101/ATCS_group3/code/pipeline_file.py", line 171, in pipeline
    answers_probs_batch, pred_answer_batch = model(
  File "/home/lcur1101/ATCS_group3/code/main_model.py", line 40, in __call__
    outputs = self.model(**inputs, labels=inputs["input_ids"])
  File "/home/lcur1101/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/lcur1101/.conda/envs/dl2022/lib/python3.10/site-packages/transformers/models/bloom/modeling_bloom.py", line 938, in forward
    loss = loss_fct(
  File "/home/lcur1101/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/lcur1101/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/loss.py", line 1174, in forward
    return F.cross_entropy(input, target, weight=self.weight,
  File "/home/lcur1101/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/functional.py", line 3029, in cross_entropy
    return torch._C._nn.cross_entropy_loss(input, target, weight, _Reduction.get_enum(reduction), ignore_index, label_smoothing)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.07 GiB (GPU 0; 23.65 GiB total capacity; 21.94 GiB already allocated; 383.56 MiB free; 22.53 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
srun: error: r35n4: task 0: Exited with exit code 1
